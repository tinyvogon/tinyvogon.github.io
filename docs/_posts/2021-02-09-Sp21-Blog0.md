---
layout: post 
title:  "SP21 - Blog 0 - Format and partition /var volume to a different disk on AWS Linux 2 instance"
date:   2021-02-09 18:34:18 -0700
categories: blog
---

When you first create your EC2 instance, everything will be placed into /root, no matter if you have attached an additional EBS volume to the instance. In order to make use of the additional EBS volume, you have to format, partition, and mount the volume to the current file system. One such way is to partition /var, a directory that is extremely frequently used, to the additional EBS volume so you have more room in /root. This article will detail the steps to this process in an Amazon Linux 2 EC2 instance.

First, log in to your EC2 instance and use `$ df-h` to review the current file system - the disks in use will show as output of this command. Then, enter the command `$ lsblk` to show all the available disks on the system. Comparing the two outputs, you can determine the additional EBS volume that hasn't been mounted to the system: 

    ![sp-blog0-1](/assets/sp-blog0-1.PNG){:class="img-responsive"}

In my case, it would be the disk **nvme1n1**. 
Then, proceed to format the disk with the approriate file system. Usually it's **ext4**. Use the command `$ sudo mkfs -t ext4 /dev/[disk-name]`.
    ![sp-blog0-4](/assets/sp-blog0-4.PNG){:class="img-responsive"}
'
Now you need to mount the formatted disk to /mnt, a temporary directory for mounting. 
` $ mount /dev/nvme1n1 /mnt`

Copy your data from the original /var in root to the temporary /mnt:
` $ cd /var`
` $ sudo cp -ax * /mnt`

Unmount the temporary partition with the command:
` $ umount /mnt`

Open **/etc/fstab** using vi/nano and add this line:
`/dev/nvme1n1   /var       ext4    defaults,noatime,nofail 0   2`

Make a /var directory outside of root:
` $ sudo mkdir /var`

Mount the newly partitioned disk with this command:
` $sudo mount -av`
The result should show:
    ![sp-blog0-8](/assets/sp-blog0-8.PNG){:class="img-responsive"}

Finally, reboot your EC2 instance. After you log back, use `$ df -h` to check all the disks in use. The newly partitioned /var in **nvme1n1** should show up:
    ![sp-blog0-9](/assets/sp-blog0-9.PNG){:class="img-responsive"}

